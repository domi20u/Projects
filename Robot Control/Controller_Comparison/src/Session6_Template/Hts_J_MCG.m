function [Hts,J,MCG]=Hts_J_MCG(qp1,qp2,qp3,q1,q2,q3,m1,m2,m3,L1,L2,L3,L4,L5,L6,L7,L8,L9,L10,I,g,gx,gy,gz)

I111=I(1);
I112=I(2);
I113=I(3);
I122=I(4);
I123=I(5);
I133=I(6);
I211=I(7);
I212=I(8);
I213=I(9);
I222=I(10);
I223=I(11);
I233=I(12);
I311=I(13);
I312=I(14);
I313=I(15);
I322=I(16);
I323=I(17);
I333=I(18);
H1_0(1,1)=cos(q1);
H1_0(1,2)=0;
H1_0(1,3)=sin(q1);
H1_0(1,4)=0;
H1_0(2,1)=sin(q1);
H1_0(2,2)=0;
H1_0(2,3)=-cos(q1);
H1_0(2,4)=0;
H1_0(3,1)=0;
H1_0(3,2)=1;
H1_0(3,3)=0;
H1_0(3,4)=L1;
H1_0(4,1)=0;
H1_0(4,2)=0;
H1_0(4,3)=0;
H1_0(4,4)=1;
H2_1(1,1)=cos(q2 + pi/2);
H2_1(1,2)=-sin(q2 + pi/2);
H2_1(1,3)=0;
H2_1(1,4)=L3*cos(q2 + pi/2);
H2_1(2,1)=sin(q2 + pi/2);
H2_1(2,2)=cos(q2 + pi/2);
H2_1(2,3)=0;
H2_1(2,4)=L3*sin(q2 + pi/2);
H2_1(3,1)=0;
H2_1(3,2)=0;
H2_1(3,3)=1;
H2_1(3,4)=0;
H2_1(4,1)=0;
H2_1(4,2)=0;
H2_1(4,3)=0;
H2_1(4,4)=1;
H3_2(1,1)=cos(q3);
H3_2(1,2)=-sin(q3);
H3_2(1,3)=0;
H3_2(1,4)=L5*cos(q3);
H3_2(2,1)=sin(q3);
H3_2(2,2)=cos(q3);
H3_2(2,3)=0;
H3_2(2,4)=L5*sin(q3);
H3_2(3,1)=0;
H3_2(3,2)=0;
H3_2(3,3)=1;
H3_2(3,4)=L2 + L4;
H3_2(4,1)=0;
H3_2(4,2)=0;
H3_2(4,3)=0;
H3_2(4,4)=1;

Hcm1_0(1,1)=cos(q1);
Hcm1_0(1,2)=-sin(q1);
Hcm1_0(1,3)=0;
Hcm1_0(1,4)=0;
Hcm1_0(2,1)=sin(q1);
Hcm1_0(2,2)=cos(q1);
Hcm1_0(2,3)=0;
Hcm1_0(2,4)=0;
Hcm1_0(3,1)=0;
Hcm1_0(3,2)=0;
Hcm1_0(3,3)=1;
Hcm1_0(3,4)=L6;
Hcm1_0(4,1)=0;
Hcm1_0(4,2)=0;
Hcm1_0(4,3)=0;
Hcm1_0(4,4)=1;
Hcm2_1(1,1)=cos(q2 + pi/2);
Hcm2_1(1,2)=-sin(q2 + pi/2);
Hcm2_1(1,3)=0;
Hcm2_1(1,4)=L8*cos(q2 + pi/2);
Hcm2_1(2,1)=sin(q2 + pi/2);
Hcm2_1(2,2)=cos(q2 + pi/2);
Hcm2_1(2,3)=0;
Hcm2_1(2,4)=L8*sin(q2 + pi/2);
Hcm2_1(3,1)=0;
Hcm2_1(3,2)=0;
Hcm2_1(3,3)=1;
Hcm2_1(3,4)=L7;
Hcm2_1(4,1)=0;
Hcm2_1(4,2)=0;
Hcm2_1(4,3)=0;
Hcm2_1(4,4)=1;
Hcm3_2(1,1)=cos(q3);
Hcm3_2(1,2)=-sin(q3);
Hcm3_2(1,3)=0;
Hcm3_2(1,4)=L10*cos(q3);
Hcm3_2(2,1)=sin(q3);
Hcm3_2(2,2)=cos(q3);
Hcm3_2(2,3)=0;
Hcm3_2(2,4)=L10*sin(q3);
Hcm3_2(3,1)=0;
Hcm3_2(3,2)=0;
Hcm3_2(3,3)=1;
Hcm3_2(3,4)=L9;
Hcm3_2(4,1)=0;
Hcm3_2(4,2)=0;
Hcm3_2(4,3)=0;
Hcm3_2(4,4)=1;

Jef(1,1)=L2*cos(q1) + L4*cos(q1) + L3*sin(q1)*sin(q2) + L5*cos(q2)*sin(q1)*sin(q3) + L5*cos(q3)*sin(q1)*sin(q2);
Jef(1,2)=-cos(q1)*(L5*cos(q2 + q3) + L3*cos(q2));
Jef(1,3)=-L5*cos(q2 + q3)*cos(q1);
Jef(2,1)=L2*sin(q1) + L4*sin(q1) - L3*cos(q1)*sin(q2) - L5*cos(q1)*cos(q2)*sin(q3) - L5*cos(q1)*cos(q3)*sin(q2);
Jef(2,2)=-sin(q1)*(L5*cos(q2 + q3) + L3*cos(q2));
Jef(2,3)=-L5*cos(q2 + q3)*sin(q1);
Jef(3,1)=0;
Jef(3,2)=- L5*sin(q2 + q3) - L3*sin(q2);
Jef(3,3)=-L5*sin(q2 + q3);
Jef(4,1)=0;
Jef(4,2)=sin(q1);
Jef(4,3)=sin(q1);
Jef(5,1)=0;
Jef(5,2)=-cos(q1);
Jef(5,3)=-cos(q1);
Jef(6,1)=1;
Jef(6,2)=0;
Jef(6,3)=0;

Jefp(1,1)=qp1*(L3*cos(q1)*sin(q2) - L4*sin(q1) - L2*sin(q1) + L5*cos(q1)*cos(q2)*sin(q3) + L5*cos(q1)*cos(q3)*sin(q2)) + qp2*sin(q1)*(L5*cos(q2 + q3) + L3*cos(q2)) + L5*qp3*cos(q2 + q3)*sin(q1);
Jefp(1,2)=qp1*sin(q1)*(L5*cos(q2 + q3) + L3*cos(q2)) + qp2*cos(q1)*(L5*sin(q2 + q3) + L3*sin(q2)) + L5*qp3*sin(q2 + q3)*cos(q1);
Jefp(1,3)=L5*qp1*cos(q2 + q3)*sin(q1) + L5*qp2*sin(q2 + q3)*cos(q1) + L5*qp3*sin(q2 + q3)*cos(q1);
Jefp(2,1)=qp1*(L2*cos(q1) + L4*cos(q1) + L3*sin(q1)*sin(q2) + L5*cos(q2)*sin(q1)*sin(q3) + L5*cos(q3)*sin(q1)*sin(q2)) - qp3*(L5*cos(q1)*cos(q2)*cos(q3) - L5*cos(q1)*sin(q2)*sin(q3)) - qp2*(L3*cos(q1)*cos(q2) + L5*cos(q1)*cos(q2)*cos(q3) - L5*cos(q1)*sin(q2)*sin(q3));
Jefp(2,2)=qp2*sin(q1)*(L5*sin(q2 + q3) + L3*sin(q2)) - qp1*cos(q1)*(L5*cos(q2 + q3) + L3*cos(q2)) + L5*qp3*sin(q2 + q3)*sin(q1);
Jefp(2,3)=L5*qp2*sin(q2 + q3)*sin(q1) - L5*qp1*cos(q2 + q3)*cos(q1) + L5*qp3*sin(q2 + q3)*sin(q1);
Jefp(3,1)=0;
Jefp(3,2)=- qp2*(L5*cos(q2 + q3) + L3*cos(q2)) - L5*qp3*cos(q2 + q3);
Jefp(3,3)=-L5*cos(q2 + q3)*(qp2 + qp3);
Jefp(4,1)=0;
Jefp(4,2)=qp1*cos(q1);
Jefp(4,3)=qp1*cos(q1);
Jefp(5,1)=0;
Jefp(5,2)=qp1*sin(q1);
Jefp(5,3)=qp1*sin(q1);
Jefp(6,1)=0;
Jefp(6,2)=0;
Jefp(6,3)=0;

M(1,1)=I133 + I222 + I311/2 + I322/2 + (I311*cos(2*q2 + 2*q3))/2 - (I322*cos(2*q2 + 2*q3))/2 - I312*sin(2*q2 + 2*q3) + (L3^2*m3)/2 + L7^2*m2 + L8^2*m2 + L9^2*m3 + (L10^2*m3)/2 + I211*cos(q2)^2 - I222*cos(q2)^2 - I212*sin(2*q2) - (L3^2*m3*cos(2*q2))/2 - L8^2*m2*cos(q2)^2 - (L10^2*m3*cos(2*q2 + 2*q3))/2 + L3*L10*m3*cos(q3) - L3*L10*m3*cos(2*q2 + q3);
M(1,2)=I313*cos(q2 + q3) - I323*sin(q2 + q3) + I213*cos(q2) - I223*sin(q2) - L9*L10*m3*cos(q2 + q3) - L3*L9*m3*cos(q2) - L7*L8*m2*cos(q2);
M(1,3)=I313*cos(q2 + q3) - I323*sin(q2 + q3) - L9*L10*m3*cos(q2 + q3);
M(2,1)=I313*cos(q2 + q3) - I323*sin(q2 + q3) + I213*cos(q2) - I223*sin(q2) - L9*L10*m3*cos(q2 + q3) - L3*L9*m3*cos(q2) - L7*L8*m2*cos(q2);
M(2,2)=I233 + I333 + L3^2*m3 + L8^2*m2 + L10^2*m3 + 2*L3*L10*m3*cos(q3);
M(2,3)=I333 + L10^2*m3 + L3*L10*m3*cos(q3);
M(3,1)=I313*cos(q2 + q3) - I323*sin(q2 + q3) - L9*L10*m3*cos(q2 + q3);
M(3,2)=I333 + L10^2*m3 + L3*L10*m3*cos(q3);
M(3,3)=I333 + L10^2*m3;

C(1,1)=(qp2*(I322*sin(2*q2 + 2*q3) - I311*sin(2*q2 + 2*q3) - 2*I312*cos(2*q2 + 2*q3) - 2*I212*cos(2*q2) - I211*sin(2*q2) + I222*sin(2*q2) + L3^2*m3*sin(2*q2) + L8^2*m2*sin(2*q2) + L10^2*m3*sin(2*q2 + 2*q3) + 2*L3*L10*m3*sin(2*q2 + q3)))/2 - (qp3*(2*I312*cos(2*q2 + 2*q3) + I311*sin(2*q2 + 2*q3) - I322*sin(2*q2 + 2*q3) - L10^2*m3*sin(2*q2 + 2*q3) + L3*L10*m3*sin(q3) - L3*L10*m3*sin(2*q2 + q3)))/2;
C(1,2)=(I222*qp1*sin(2*q2))/2 - (I211*qp1*sin(2*q2))/2 - I212*qp1*cos(2*q2) - I312*qp1*cos(2*q2 + 2*q3) - (I311*qp1*sin(2*q2 + 2*q3))/2 + (I322*qp1*sin(2*q2 + 2*q3))/2 - I323*qp2*cos(q2 + q3) - I323*qp3*cos(q2 + q3) - I313*qp2*sin(q2 + q3) - I313*qp3*sin(q2 + q3) - I223*qp2*cos(q2) - I213*qp2*sin(q2) + (L3^2*m3*qp1*sin(2*q2))/2 + (L8^2*m2*qp1*sin(2*q2))/2 + (L10^2*m3*qp1*sin(2*q2 + 2*q3))/2 + L9*L10*m3*qp2*sin(q2 + q3) + L9*L10*m3*qp3*sin(q2 + q3) + L3*L9*m3*qp2*sin(q2) + L7*L8*m2*qp2*sin(q2) + L3*L10*m3*qp1*sin(2*q2 + q3);
C(1,3)=- (qp1*(2*I312*cos(2*q2 + 2*q3) + I311*sin(2*q2 + 2*q3) - I322*sin(2*q2 + 2*q3) - L10^2*m3*sin(2*q2 + 2*q3) + L3*L10*m3*sin(q3) - L3*L10*m3*sin(2*q2 + q3)))/2 - (qp2*(2*I323*cos(q2 + q3) + 2*I313*sin(q2 + q3) - 2*L9*L10*m3*sin(q2 + q3)))/2 - (qp3*(2*I323*cos(q2 + q3) + 2*I313*sin(q2 + q3) - 2*L9*L10*m3*sin(q2 + q3)))/2;
C(2,1)=-(qp1*(I322*sin(2*q2 + 2*q3) - I311*sin(2*q2 + 2*q3) - 2*I312*cos(2*q2 + 2*q3) - 2*I212*cos(2*q2) - I211*sin(2*q2) + I222*sin(2*q2) + L3^2*m3*sin(2*q2) + L8^2*m2*sin(2*q2) + L10^2*m3*sin(2*q2 + 2*q3) + 2*L3*L10*m3*sin(2*q2 + q3)))/2;
C(2,2)=-L3*L10*m3*qp3*sin(q3);
C(2,3)=-L3*L10*m3*sin(q3)*(qp2 + qp3);
C(3,1)=(qp1*(2*I312*cos(2*q2 + 2*q3) + I311*sin(2*q2 + 2*q3) - I322*sin(2*q2 + 2*q3) - L10^2*m3*sin(2*q2 + 2*q3) + L3*L10*m3*sin(q3) - L3*L10*m3*sin(2*q2 + q3)))/2;
C(3,2)=L3*L10*m3*qp2*sin(q3);
C(3,3)=0;

G(1,1)=g*(L7*gx*m2*cos(q1) + L9*gx*m3*cos(q1) + L7*gy*m2*sin(q1) + L9*gy*m3*sin(q1) - L3*gy*m3*cos(q1)*sin(q2) - L8*gy*m2*cos(q1)*sin(q2) + L3*gx*m3*sin(q1)*sin(q2) + L8*gx*m2*sin(q1)*sin(q2) - L10*gy*m3*cos(q1)*cos(q2)*sin(q3) - L10*gy*m3*cos(q1)*cos(q3)*sin(q2) + L10*gx*m3*cos(q2)*sin(q1)*sin(q3) + L10*gx*m3*cos(q3)*sin(q1)*sin(q2));
G(2,1)=-g*(L3*gz*m3*sin(q2) + L8*gz*m2*sin(q2) + L3*gx*m3*cos(q1)*cos(q2) + L8*gx*m2*cos(q1)*cos(q2) + L3*gy*m3*cos(q2)*sin(q1) + L8*gy*m2*cos(q2)*sin(q1) + L10*gz*m3*cos(q2)*sin(q3) + L10*gz*m3*cos(q3)*sin(q2) + L10*gy*m3*cos(q2)*cos(q3)*sin(q1) - L10*gx*m3*cos(q1)*sin(q2)*sin(q3) - L10*gy*m3*sin(q1)*sin(q2)*sin(q3) + L10*gx*m3*cos(q1)*cos(q2)*cos(q3));
G(3,1)=-L10*g*m3*(gz*cos(q2)*sin(q3) + gz*cos(q3)*sin(q2) + gx*cos(q1)*cos(q2)*cos(q3) + gy*cos(q2)*cos(q3)*sin(q1) - gx*cos(q1)*sin(q2)*sin(q3) - gy*sin(q1)*sin(q2)*sin(q3));

Hts(:,:,1)=H1_0;
Hts(:,:,2)=H2_1;
Hts(:,:,3)=H3_2;
Hts(:,:,4)=Hcm1_0;
Hts(:,:,5)=Hcm2_1;
Hts(:,:,6)=Hcm3_2;
J{1}=Jef;
J{2}=Jefp;
MCG{1}=M;
MCG{2}=C;
MCG{3}=G;
